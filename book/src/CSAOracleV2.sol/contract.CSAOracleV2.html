<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CSAOracleV2</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="../../src/CSAEngineV2/index.html">❱ CSAEngineV2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSAEngineV2/CSAEngineV2.sol/contract.CSAEngineV2.html">CSAEngineV2</a></li><li class="chapter-item "><a href="../../src/CSAEngineV2/CSAEngineV2StorageContract.sol/contract.CSAEngineV2StorageContract.html">CSAEngineV2StorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSAMarketplace/index.html">❱ CSAMarketplace</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSAMarketplace/CSAMarketplace.sol/contract.CSAMarketplace.html">CSAMarketplace</a></li><li class="chapter-item "><a href="../../src/CSAMarketplace/CSAMarketplaceStorageContract.sol/contract.CSAMarketplaceStorageContract.html">CSAMarketplaceStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSASwap/index.html">❱ CSASwap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSASwap/CSASwap.sol/contract.CSASwap.html">CSASwap</a></li><li class="chapter-item "><a href="../../src/CSASwap/CSASwapStorageContract.sol/contract.CSASwapStorageContract.html">CSASwapStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSAT/index.html">❱ CSAT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSAT/CSAT.sol/contract.CSAT.html">CSAT</a></li><li class="chapter-item "><a href="../../src/CSAT/CSATStorageContract.sol/contract.CSATStorageContract.html">CSATStorageContract</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/CSAOracleV2.sol/contract.CSAOracleV2.html" class="active">CSAOracleV2</a></li><li class="chapter-item "><a href="../../src/CSAQueueLib.sol/library.CSAQueueLib.html">CSAQueueLib</a></li><li class="chapter-item "><a href="../../src/CSATBuyer.sol/contract.CSATBuyer.html">CSATBuyer</a></li><li class="chapter-item "><a href="../../src/CSAVault.sol/contract.CSAVault.html">CSAVault</a></li><li class="chapter-item "><a href="../../src/IBurnableMintable.sol/interface.Mintable.html">Mintable</a></li><li class="chapter-item "><a href="../../src/IBurnableMintable.sol/interface.Burnable.html">Burnable</a></li><li class="chapter-item "><a href="../../src/TransferManager.sol/contract.TransferManager.html">TransferManager</a></li><li class="chapter-item "><a href="../../src/USDCMock.sol/contract.USDCMock.html">USDCMock</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="csaoraclev2"><a class="header" href="#csaoraclev2">CSAOracleV2</a></h1>
<p><strong>Inherits:</strong>
AccessControl</p>
<p><strong>Author:</strong>
Maurizio Murru https://github.com/akerbabber</p>
<p><em>This contract functions as an oracle to store and manage information
related to footballers' scores and match timestamps. It leverages the
AccessControl contract from OpenZeppelin to manage access permissions and roles.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="footballers"><a class="header" href="#footballers">footballers</a></h3>
<p><em>Mapping from playerId to Footballer struct, storing footballer data.</em></p>
<pre><code class="language-solidity">mapping(uint256 =&gt; Footballer) public footballers;
</code></pre>
<h3 id="updater_role"><a class="header" href="#updater_role">UPDATER_ROLE</a></h3>
<p><em>Role identifier for users who can update footballer scores.</em></p>
<pre><code class="language-solidity">bytes32 public constant UPDATER_ROLE = keccak256("UPDATER_ROLE");
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p><em>Initializes the contract setting the deployer as the initial admin.</em></p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="updatefootballerscore"><a class="header" href="#updatefootballerscore">updateFootballerScore</a></h3>
<p><em>Allows to update the footballer’s score and match timestamps.
Can only be called by addresses with the UPDATER_ROLE.
Emits a FootballerScoreUpdated event.</em></p>
<pre><code class="language-solidity">function updateFootballerScore(
    uint256 _playerId,
    uint24 _score,
    uint32 _nextMatchTimestamp,
    uint32 _previousNextMatchTimestamp,
    uint32 _lastMatchTimestamp,
    uint32 _lastScoreVariationTimestamp
) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_playerId</code></td><td><code>uint256</code></td><td>The unique identifier of the footballer.</td></tr>
<tr><td><code>_score</code></td><td><code>uint24</code></td><td>The updated score.</td></tr>
<tr><td><code>_nextMatchTimestamp</code></td><td><code>uint32</code></td><td>The updated timestamp of the next match.</td></tr>
<tr><td><code>_previousNextMatchTimestamp</code></td><td><code>uint32</code></td><td>The updated timestamp of the previous 'next match'.</td></tr>
<tr><td><code>_lastMatchTimestamp</code></td><td><code>uint32</code></td><td>The updated timestamp of the last match.</td></tr>
<tr><td><code>_lastScoreVariationTimestamp</code></td><td><code>uint32</code></td><td>The timestamp of the last score variation (not stored).</td></tr>
</tbody></table>
</div>
<h3 id="updatefootballerscorebundle"><a class="header" href="#updatefootballerscorebundle">updateFootballerScoreBundle</a></h3>
<p><em>Allows to update the scores and match timestamps for multiple footballers.
Can only be called by addresses with the UPDATER_ROLE.
Emits multiple FootballerScoreUpdated events.</em></p>
<pre><code class="language-solidity">function updateFootballerScoreBundle(
    uint256[] calldata _playerIds,
    uint24[] calldata _scores,
    uint32[] calldata _nextMatchTimestamps,
    uint32[] calldata _previousNextMatchTimestamps,
    uint32[] calldata _lastMatchTimestamps
) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_playerIds</code></td><td><code>uint256[]</code></td><td>An array of player identifiers.</td></tr>
<tr><td><code>_scores</code></td><td><code>uint24[]</code></td><td>An array of scores corresponding to the players.</td></tr>
<tr><td><code>_nextMatchTimestamps</code></td><td><code>uint32[]</code></td><td>An array of next match timestamps corresponding to the players.</td></tr>
<tr><td><code>_previousNextMatchTimestamps</code></td><td><code>uint32[]</code></td><td>An array of previous 'next match' timestamps corresponding to the players.</td></tr>
<tr><td><code>_lastMatchTimestamps</code></td><td><code>uint32[]</code></td><td>An array of last match timestamps corresponding to the players.</td></tr>
</tbody></table>
</div>
<h3 id="getfootballer"><a class="header" href="#getfootballer">getFootballer</a></h3>
<p><em>Returns the footballer data for a given player ID.</em></p>
<pre><code class="language-solidity">function getFootballer(uint256 _playerId) external view returns (Footballer memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_playerId</code></td><td><code>uint256</code></td><td>The unique identifier of the footballer.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>Footballer</code></td><td>Footballer memory The footballer data.</td></tr>
</tbody></table>
</div>
<h3 id="getfootballers"><a class="header" href="#getfootballers">getFootballers</a></h3>
<p><em>Returns the footballer data for a given array of player IDs.</em></p>
<pre><code class="language-solidity">function getFootballers(uint256[] calldata _playerIds) external view returns (Footballer[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_playerIds</code></td><td><code>uint256[]</code></td><td>An array of unique identifiers of the footballers.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>Footballer[]</code></td><td>Footballer[] memory An array containing the footballer data for each provided ID.</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="footballerscoreupdated"><a class="header" href="#footballerscoreupdated">FootballerScoreUpdated</a></h3>
<p><em>Event emitted when a footballer's score is updated.</em></p>
<pre><code class="language-solidity">event FootballerScoreUpdated(
    uint256 indexed playerId, uint24 score, uint32 nextMatchTimestamp, uint32 lastMatchTimestamp
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>playerId</code></td><td><code>uint256</code></td><td>The unique identifier of the footballer.</td></tr>
<tr><td><code>score</code></td><td><code>uint24</code></td><td>The updated score of the footballer.</td></tr>
<tr><td><code>nextMatchTimestamp</code></td><td><code>uint32</code></td><td>The updated timestamp of the next match.</td></tr>
<tr><td><code>lastMatchTimestamp</code></td><td><code>uint32</code></td><td>The updated timestamp of the last match.</td></tr>
</tbody></table>
</div>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="notupdater"><a class="header" href="#notupdater">NotUpdater</a></h3>
<p><em>Custom error to throw if the caller does not have updater role.</em></p>
<pre><code class="language-solidity">error NotUpdater(address _address);
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="footballer"><a class="header" href="#footballer">Footballer</a></h3>
<p><em>Struct representing a Footballer.</em></p>
<pre><code class="language-solidity">struct Footballer {
    uint24 score;
    uint32 nextMatchTimestamp;
    uint32 previousNextMatchTimestamp;
    uint32 lastMatchTimestamp;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>score</code></td><td><code>uint24</code></td><td>The score associated with the footballer.</td></tr>
<tr><td><code>nextMatchTimestamp</code></td><td><code>uint32</code></td><td>The timestamp of the footballer's next match.</td></tr>
<tr><td><code>previousNextMatchTimestamp</code></td><td><code>uint32</code></td><td>The timestamp of the previous 'next match' before the latest update.</td></tr>
<tr><td><code>lastMatchTimestamp</code></td><td><code>uint32</code></td><td>The timestamp of the footballer's last match.</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/CSAT/CSATStorageContract.sol/contract.CSATStorageContract.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../src/CSAQueueLib.sol/library.CSAQueueLib.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/CSAT/CSATStorageContract.sol/contract.CSATStorageContract.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../src/CSAQueueLib.sol/library.CSAQueueLib.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../solidity.min.js"></script>


    </div>
    </body>
</html>
