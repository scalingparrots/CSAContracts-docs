<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CSATeamOracle</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="../../src/CSAEngineV2/index.html">❱ CSAEngineV2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSAEngineV2/CSAEngineV2.sol/contract.CSAEngineV2.html">CSAEngineV2</a></li><li class="chapter-item "><a href="../../src/CSAEngineV2/CSAEngineV2StorageContract.sol/contract.CSAEngineV2StorageContract.html">CSAEngineV2StorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSAMarketplace/index.html">❱ CSAMarketplace</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSAMarketplace/CSAMarketplace.sol/contract.CSAMarketplace.html">CSAMarketplace</a></li><li class="chapter-item "><a href="../../src/CSAMarketplace/CSAMarketplaceStorageContract.sol/contract.CSAMarketplaceStorageContract.html">CSAMarketplaceStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSASwap/index.html">❱ CSASwap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSASwap/CSASwap.sol/contract.CSASwap.html">CSASwap</a></li><li class="chapter-item "><a href="../../src/CSASwap/CSASwapStorageContract.sol/contract.CSASwapStorageContract.html">CSASwapStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSAT/index.html">❱ CSAT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSAT/CSAT.sol/contract.CSAT.html">CSAT</a></li><li class="chapter-item "><a href="../../src/CSAT/CSATStorageContract.sol/contract.CSATStorageContract.html">CSATStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSATTeam/index.html">❱ CSATTeam</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/CSATTeam/CSATTeam.sol/contract.CSATTeam.html">CSATTeam</a></li><li class="chapter-item "><a href="../../src/CSATTeam/CSATTeamStorageContract.sol/contract.CSATTeamStorageContract.html">CSATTeamStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../src/CSAOracleV2.sol/contract.CSAOracleV2.html">CSAOracleV2</a></li><li class="chapter-item "><a href="../../src/CSAQueueLib.sol/library.CSAQueueLib.html">CSAQueueLib</a></li><li class="chapter-item "><a href="../../src/CSATBuyer.sol/contract.CSATBuyer.html">CSATBuyer</a></li><li class="chapter-item expanded "><a href="../../src/CSATeamOracle.sol/contract.CSATeamOracle.html" class="active">CSATeamOracle</a></li><li class="chapter-item "><a href="../../src/CSAVault.sol/contract.CSAVault.html">CSAVault</a></li><li class="chapter-item "><a href="../../src/IBurnableMintable.sol/interface.Mintable.html">Mintable</a></li><li class="chapter-item "><a href="../../src/IBurnableMintable.sol/interface.Burnable.html">Burnable</a></li><li class="chapter-item "><a href="../../src/TransferManager.sol/contract.TransferManager.html">TransferManager</a></li><li class="chapter-item "><a href="../../src/USDCMock.sol/contract.USDCMock.html">USDCMock</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="csateamoracle"><a class="header" href="#csateamoracle">CSATeamOracle</a></h1>
<p><strong>Inherits:</strong>
AccessControl</p>
<p><strong>Author:</strong>
Maurizio Murru https://github.com/akerbabber</p>
<p><em>This contract functions as an oracle to store and manage information
related to footballers' scores and match timestamps. It leverages the
AccessControl contract from OpenZeppelin to manage access permissions and roles.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="footballers"><a class="header" href="#footballers">footballers</a></h3>
<p><em>Array to store footballers' scores.
The array is structured as follows: [footballerId1, score1, footballerId2, score2, ...]</em></p>
<pre><code class="language-solidity">uint24[] public footballers;
</code></pre>
<h3 id="indexvalue"><a class="header" href="#indexvalue">indexValue</a></h3>
<p><em>The index value of the team.</em></p>
<pre><code class="language-solidity">Index[] public indexValue;
</code></pre>
<h3 id="oracle"><a class="header" href="#oracle">oracle</a></h3>
<p><em>Address of the CSAOracleV2 contract to store the index value and make it available to the CSAEngineV2 contract.</em></p>
<pre><code class="language-solidity">CSAOracleV2 public immutable oracle;
</code></pre>
<h3 id="updater_role"><a class="header" href="#updater_role">UPDATER_ROLE</a></h3>
<p><em>Role identifier for users who can update footballer scores.</em></p>
<pre><code class="language-solidity">bytes32 public constant UPDATER_ROLE = keccak256("UPDATER_ROLE");
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p><em>Initializes the contract setting the deployer as the initial admin.</em></p>
<pre><code class="language-solidity">constructor(uint24 _indexStartingValue, CSAOracleV2 _oracle);
</code></pre>
<h3 id="updateindex"><a class="header" href="#updateindex">updateIndex</a></h3>
<p><em>Updates the footballers' scores and the index value of the team.</em></p>
<pre><code class="language-solidity">function updateIndex(uint24[] calldata _footballers, uint24 _indexValue) public;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_footballers</code></td><td><code>uint24[]</code></td><td>Array of Footballer structs containing the ID and score of each footballer.</td></tr>
<tr><td><code>_indexValue</code></td><td><code>uint24</code></td><td>The index value of the team.</td></tr>
</tbody></table>
</div>
<h3 id="getfootballersstruct"><a class="header" href="#getfootballersstruct">getFootballersStruct</a></h3>
<p><em>Returns the footballers' scores.</em></p>
<pre><code class="language-solidity">function getFootballersStruct() public view returns (Footballer[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>Footballer[]</code></td><td>Array of Footballer structs containing the ID and score of each footballer.</td></tr>
</tbody></table>
</div>
<h3 id="getfootballers"><a class="header" href="#getfootballers">getFootballers</a></h3>
<p><em>Returns the footballers' RAW array.</em></p>
<pre><code class="language-solidity">function getFootballers() public view returns (uint24[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint24[]</code></td><td>Array of footballers' IDs and scores.</td></tr>
</tbody></table>
</div>
<h3 id="getindexvalue"><a class="header" href="#getindexvalue">getIndexValue</a></h3>
<pre><code class="language-solidity">function getIndexValue() public view returns (Index[] memory);
</code></pre>
<h3 id="getlastindexvalue"><a class="header" href="#getlastindexvalue">getLastIndexValue</a></h3>
<pre><code class="language-solidity">function getLastIndexValue() public view returns (Index memory);
</code></pre>
<h3 id="_indexvaluebetweentwodates"><a class="header" href="#_indexvaluebetweentwodates">_indexValueBetweenTwoDates</a></h3>
<pre><code class="language-solidity">function _indexValueBetweenTwoDates(uint256 start, uint256 end) internal view returns (Index[] memory);
</code></pre>
<h3 id="getprofitandloss"><a class="header" href="#getprofitandloss">getProfitAndLoss</a></h3>
<pre><code class="language-solidity">function getProfitAndLoss() public view returns (int256);
</code></pre>
<h3 id="getprofitandlossfrombeginning"><a class="header" href="#getprofitandlossfrombeginning">getProfitAndLossFromBeginning</a></h3>
<pre><code class="language-solidity">function getProfitAndLossFromBeginning() public view returns (int256);
</code></pre>
<h3 id="getprofitandlossbetweentwodates"><a class="header" href="#getprofitandlossbetweentwodates">getProfitAndLossBetweenTwoDates</a></h3>
<pre><code class="language-solidity">function getProfitAndLossBetweenTwoDates(uint256 start, uint256 end) public view returns (int256);
</code></pre>
<h3 id="indexvaluebetweentwodates"><a class="header" href="#indexvaluebetweentwodates">indexValueBetweenTwoDates</a></h3>
<pre><code class="language-solidity">function indexValueBetweenTwoDates(uint256 start, uint256 end) public view returns (Index[] memory);
</code></pre>
<h3 id="calculatepercentage"><a class="header" href="#calculatepercentage">calculatePercentage</a></h3>
<pre><code class="language-solidity">function calculatePercentage(uint256 numerator, uint256 denominator) public pure returns (int256);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="notupdater"><a class="header" href="#notupdater">NotUpdater</a></h3>
<p><em>Custom error to throw if the caller does not have updater role.</em></p>
<pre><code class="language-solidity">error NotUpdater(address _address);
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="footballer"><a class="header" href="#footballer">Footballer</a></h3>
<pre><code class="language-solidity">struct Footballer {
    uint24 id;
    uint24 score;
}
</code></pre>
<h3 id="index"><a class="header" href="#index">Index</a></h3>
<pre><code class="language-solidity">struct Index {
    uint24 indexValue;
    uint32 timestamp;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/CSATBuyer.sol/contract.CSATBuyer.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../src/CSAVault.sol/contract.CSAVault.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/CSATBuyer.sol/contract.CSATBuyer.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../src/CSAVault.sol/contract.CSAVault.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../solidity.min.js"></script>


    </div>
    </body>
</html>
