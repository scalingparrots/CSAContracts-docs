<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CSAMarketplace</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="../../../src/CSAEngineV2/index.html">❱ CSAEngineV2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/CSAEngineV2/CSAEngineV2.sol/contract.CSAEngineV2.html">CSAEngineV2</a></li><li class="chapter-item "><a href="../../../src/CSAEngineV2/CSAEngineV2StorageContract.sol/contract.CSAEngineV2StorageContract.html">CSAEngineV2StorageContract</a></li></ol></li><li class="chapter-item expanded "><a href="../../../src/CSAMarketplace/index.html">❱ CSAMarketplace</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../src/CSAMarketplace/CSAMarketplace.sol/contract.CSAMarketplace.html" class="active">CSAMarketplace</a></li><li class="chapter-item "><a href="../../../src/CSAMarketplace/CSAMarketplaceStorageContract.sol/contract.CSAMarketplaceStorageContract.html">CSAMarketplaceStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../../src/CSASwap/index.html">❱ CSASwap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/CSASwap/CSASwap.sol/contract.CSASwap.html">CSASwap</a></li><li class="chapter-item "><a href="../../../src/CSASwap/CSASwapStorageContract.sol/contract.CSASwapStorageContract.html">CSASwapStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../../src/CSAT/index.html">❱ CSAT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/CSAT/CSAT.sol/contract.CSAT.html">CSAT</a></li><li class="chapter-item "><a href="../../../src/CSAT/CSATStorageContract.sol/contract.CSATStorageContract.html">CSATStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../../src/CSATTeam/index.html">❱ CSATTeam</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/CSATTeam/CSATTeam.sol/contract.CSATTeam.html">CSATTeam</a></li><li class="chapter-item "><a href="../../../src/CSATTeam/CSATTeamStorageContract.sol/contract.CSATTeamStorageContract.html">CSATTeamStorageContract</a></li></ol></li><li class="chapter-item "><a href="../../../src/CSAOracleV2.sol/contract.CSAOracleV2.html">CSAOracleV2</a></li><li class="chapter-item "><a href="../../../src/CSAQueueLib.sol/library.CSAQueueLib.html">CSAQueueLib</a></li><li class="chapter-item "><a href="../../../src/CSATBuyer.sol/contract.CSATBuyer.html">CSATBuyer</a></li><li class="chapter-item "><a href="../../../src/CSATeamOracle.sol/contract.CSATeamOracle.html">CSATeamOracle</a></li><li class="chapter-item "><a href="../../../src/CSAVault.sol/contract.CSAVault.html">CSAVault</a></li><li class="chapter-item "><a href="../../../src/IBurnableMintable.sol/interface.Mintable.html">Mintable</a></li><li class="chapter-item "><a href="../../../src/IBurnableMintable.sol/interface.Burnable.html">Burnable</a></li><li class="chapter-item "><a href="../../../src/TransferManager.sol/contract.TransferManager.html">TransferManager</a></li><li class="chapter-item "><a href="../../../src/USDCMock.sol/contract.USDCMock.html">USDCMock</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="csamarketplace"><a class="header" href="#csamarketplace">CSAMarketplace</a></h1>
<p><strong>Inherits:</strong>
Initializable, AccessControlUpgradeable, UUPSUpgradeable, ERC2771ContextUpgradeable, <a href="/src/CSAMarketplace/CSAMarketplaceStorageContract.sol/contract.CSAMarketplaceStorageContract.html">CSAMarketplaceStorageContract</a></p>
<p><strong>Author:</strong>
Maurizio Murru https://github.com/akerbabber</p>
<p><em>This contract implements a marketplace for buying and selling CSAT tokens.
CSAT can be exchanged with a token chosen at deployment time.
It uses a queue data structure to match sell orders with buy orders.
The price of the token is determined by two Chainlink oracles: EUR/USD and Token/USD.
The contract also has a vault to store the tokens and a fee system for the marketplace.</em></p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p><em>Constructor function for the CSAMarketplace contract.</em></p>
<pre><code class="language-solidity">constructor(
    address _csat,
    address _tokenOut,
    AggregatorV3Interface _EURUSDOracle,
    AggregatorV3Interface _TokenUSDOracle,
    address _vault,
    uint256 _minBuyAmount,
    uint256 _dustAmount,
    address _trustedForwarder
)
    ERC2771ContextUpgradeable(_trustedForwarder)
    CSAMarketplaceStorageContract(_csat, _tokenOut, _EURUSDOracle, _TokenUSDOracle, _vault, _minBuyAmount, _dustAmount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_csat</code></td><td><code>address</code></td><td>The address of the CSAT token contract.</td></tr>
<tr><td><code>_tokenOut</code></td><td><code>address</code></td><td>The address of the token contract exchanged for CSAT.</td></tr>
<tr><td><code>_EURUSDOracle</code></td><td><code>AggregatorV3Interface</code></td><td>The address of the EUR/USD price oracle contract.</td></tr>
<tr><td><code>_TokenUSDOracle</code></td><td><code>AggregatorV3Interface</code></td><td>The address of the token/USD price oracle contract.</td></tr>
<tr><td><code>_vault</code></td><td><code>address</code></td><td>The address of the CSAVault contract.</td></tr>
<tr><td><code>_minBuyAmount</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>_dustAmount</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>_trustedForwarder</code></td><td><code>address</code></td><td>The address of the trusted EIP-2771 forwarder.</td></tr>
</tbody></table>
</div>
<h3 id="initialize"><a class="header" href="#initialize">initialize</a></h3>
<p><em>Initialize function for the CSAMarketplace contract.</em></p>
<pre><code class="language-solidity">function initialize(uint16 _priceFee) public initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_priceFee</code></td><td><code>uint16</code></td><td>The fee percentage charged on the token price.</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade"><a class="header" href="#_authorizeupgrade">_authorizeUpgrade</a></h3>
<p><em>Reverts if called by any account other than an upgrader.</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal override onlyRole(UPGRADER_ROLE);
</code></pre>
<h3 id="makecsatsellorder"><a class="header" href="#makecsatsellorder">makeCsatSellOrder</a></h3>
<p>The sell order will only be created if the amount is greater than or equal to 5 ether.</p>
<p>The CSAT tokens will be transferred from the seller's account to the marketplace contract.</p>
<p>Emits a Make event with the seller's address and the amount of CSAT tokens.</p>
<p>Uses the CSAQueueLib library to add the sell order to the sellOrders queue.</p>
<p><em>Creates a sell order for the specified amount of CSAT tokens.</em></p>
<pre><code class="language-solidity">function makeCsatSellOrder(uint256 _amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The amount of CSAT tokens to sell.</td></tr>
</tbody></table>
</div>
<h3 id="cancelcsatsellorder"><a class="header" href="#cancelcsatsellorder">cancelCsatSellOrder</a></h3>
<p><em>Cancels a sell order for CSA tokens in the CSA marketplace.</em></p>
<pre><code class="language-solidity">function cancelCsatSellOrder(uint48 _orderId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_orderId</code></td><td><code>uint48</code></td><td>The ID of the sell order to be cancelled. Emits a <a href="/src/CSAMarketplace/CSAMarketplace.sol/contract.CSAMarketplace.html#notorderowner">NotOrderOwner</a> error if the caller is not the owner of the sell order.</td></tr>
</tbody></table>
</div>
<h3 id="buy"><a class="header" href="#buy">buy</a></h3>
<p><em>This function allows a user to buy CSAT from the marketplace by matching the user's buy order with the first sell order in the queue.
If the first sell order is not enough, it will look up for the second and repeat up until the fourth.
If up until the fourth is not enough, a fallback id can be supplied to finish matching the order.</em></p>
<pre><code class="language-solidity">function buy(uint256 _amountIn, uint48 _fallbackId) external returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amountIn</code></td><td><code>uint256</code></td><td>The amount of tokens to buy.</td></tr>
<tr><td><code>_fallbackId</code></td><td><code>uint48</code></td><td>The fallback id to use if the first four sell orders are not enough to match the buy order.</td></tr>
</tbody></table>
</div>
<h3 id="buyfor"><a class="header" href="#buyfor">buyFor</a></h3>
<p><em>This function allows a user to buy CSAT for another address from the marketplace by matching the user's buy order with the first sell order in the queue.
If the first sell order is not enough, it will look up for the second and repeat up until the fourth.
If up until the fourth is not enough, a fallback id can be supplied to finish matching the order.</em></p>
<pre><code class="language-solidity">function buyFor(uint256 _amountIn, uint48 _fallbackId, address receiver) external returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amountIn</code></td><td><code>uint256</code></td><td>The amount of tokens to buy.</td></tr>
<tr><td><code>_fallbackId</code></td><td><code>uint48</code></td><td>The fallback id to use if the first four sell orders are not enough to match the buy order.</td></tr>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address to receive the CSAT tokens.</td></tr>
</tbody></table>
</div>
<h3 id="_buy"><a class="header" href="#_buy">_buy</a></h3>
<p><em>Internal function to execute a buy order.</em></p>
<pre><code class="language-solidity">function _buy(uint256 _amountIn, uint48 _fallbackId, address receiver) internal returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amountIn</code></td><td><code>uint256</code></td><td>The amount of tokens to buy.</td></tr>
<tr><td><code>_fallbackId</code></td><td><code>uint48</code></td><td>The fallback id to use if the first four sell orders are not enough to match the buy order.</td></tr>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address to receive the CSAT tokens.</td></tr>
</tbody></table>
</div>
<h3 id="convertamountstotokenin"><a class="header" href="#convertamountstotokenin">convertAmountsToTokenIn</a></h3>
<p><em>This function converts an array of base amounts to a proportional array of amounts in a given token.
The conversion is based on the proportion of each amount in the input array to the sum of all amounts
in the input array, scaled by the given <code>amountIn</code>.</em></p>
<pre><code class="language-solidity">function convertAmountsToTokenIn(uint256[] memory _amounts, uint256 amountIn) public pure returns (uint256[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amounts</code></td><td><code>uint256[]</code></td><td>An array of uint256 amounts representing the base amounts to be converted. Each element in this array will be converted to a corresponding amount in the token, based on its proportion to the sum of all elements in the array.</td></tr>
<tr><td><code>amountIn</code></td><td><code>uint256</code></td><td>The uint256 amount in the token to be distributed among the <code>_amounts</code>. This amount is used to scale the proportionally distributed amounts in the resulting array.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256[]</code></td><td>amountsIn An array of uint256 representing the converted amounts in the token. Each element in this array is the converted amount of the corresponding element in the input <code>_amounts</code>, scaled by the <code>amountIn</code>.</td></tr>
</tbody></table>
</div>
<h3 id="convertamounttoeurprice"><a class="header" href="#convertamounttoeurprice">convertAmountToEURPrice</a></h3>
<p><em>Converts the given amount of tokens to its equivalent EUR price.</em></p>
<pre><code class="language-solidity">function convertAmountToEURPrice(uint256 _amount) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The amount of tokens to convert.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The equivalent EUR price of the given amount of tokens. Requirements: - The token and EUR/USD oracles must have a positive price.</td></tr>
</tbody></table>
</div>
<h3 id="convertamountincsattotokenprice"><a class="header" href="#convertamountincsattotokenprice">convertAmountInCsatToTokenPrice</a></h3>
<p>This function uses the latest round data from the TokenUSDOracle and EURUSDOracle to calculate the token price.</p>
<p>The token and CSAT decimals are obtained from their respective IERC20Metadata interfaces.</p>
<p>If the TokenUSDPrice or EURUSDPrice is less than zero, a PriceLessThanZero error is thrown.</p>
<p><em>Converts an amount in CSAT to its equivalent token price.</em></p>
<pre><code class="language-solidity">function convertAmountInCsatToTokenPrice(uint256 _amount) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The amount in CSAT to convert.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The equivalent token price in the token's decimals.</td></tr>
</tbody></table>
</div>
<h3 id="_getfallbackidorder"><a class="header" href="#_getfallbackidorder">_getFallbackIdOrder</a></h3>
<p>This function is expensive and should not be called on-chain.</p>
<p>The number of orders checked on top of the queue should not be included as fallbacks.</p>
<p>If no order is enough to be a fallback, it will revert.</p>
<p><em>Returns the fallback order ID for a given amount of tokens,
it starts from the head of the queue, skips the first MAX_N_ORDERS orders
and goes down until it finds an order that is enough.</em></p>
<pre><code class="language-solidity">function _getFallbackIdOrder(uint256 _amount) internal view returns (uint48 currentId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The amount of tokens to get the fallback order for.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>currentId</code></td><td><code>uint48</code></td><td>The ID of the fallback order.</td></tr>
</tbody></table>
</div>
<h3 id="getfallbackidorderfromconvertedamount"><a class="header" href="#getfallbackidorderfromconvertedamount">getFallbackIdOrderFromConvertedAmount</a></h3>
<p><em>Returns the ID of the fallback order for a given converted amount.</em></p>
<pre><code class="language-solidity">function getFallbackIdOrderFromConvertedAmount(uint256 _amount) external view returns (uint48 currentId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The converted amount to get the fallback order ID for.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>currentId</code></td><td><code>uint48</code></td><td>The ID of the fallback order. This function should not be called on-chain as it is expensive.</td></tr>
</tbody></table>
</div>
<h3 id="getfallbackidorder"><a class="header" href="#getfallbackidorder">getFallbackIdOrder</a></h3>
<p><em>Returns the current fallback ID order for a given amount.</em></p>
<pre><code class="language-solidity">function getFallbackIdOrder(uint256 _amount) external view returns (uint48 currentId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The amount to get the fallback ID order for.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>currentId</code></td><td><code>uint48</code></td><td>The current fallback ID order. This function should not be called on-chain as it is expensive.</td></tr>
</tbody></table>
</div>
<h3 id="getqueuehead"><a class="header" href="#getqueuehead">getQueueHead</a></h3>
<p><em>Returns the head of the sell orders queue.</em></p>
<pre><code class="language-solidity">function getQueueHead() public view returns (uint48);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint48</code></td><td>The head of the sell orders queue as a uint48 value.</td></tr>
</tbody></table>
</div>
<h3 id="getqueuetail"><a class="header" href="#getqueuetail">getQueueTail</a></h3>
<p><em>Returns the tail of the sell orders queue.</em></p>
<pre><code class="language-solidity">function getQueueTail() public view returns (uint48);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint48</code></td><td>The tail of the sell orders queue.</td></tr>
</tbody></table>
</div>
<h3 id="getqueueorder"><a class="header" href="#getqueueorder">getQueueOrder</a></h3>
<p><em>Returns the order at the specified index in the sellOrders queue.</em></p>
<pre><code class="language-solidity">function getQueueOrder(uint48 _orderId) public view returns (CSAQueueLib.Order memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_orderId</code></td><td><code>uint48</code></td><td>The ID of the order to retrieve.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>CSAQueueLib.Order</code></td><td>The order at the specified index in the sellOrders queue.</td></tr>
</tbody></table>
</div>
<h3 id="getallqueueordersownedby"><a class="header" href="#getallqueueordersownedby">getAllQueueOrdersOwnedBy</a></h3>
<p><em>Returns an array of all queue orders owned by a specific address.</em></p>
<pre><code class="language-solidity">function getAllQueueOrdersOwnedBy(address owner) external view returns (uint48[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner</code></td><td><code>address</code></td><td>The address of the owner to filter the orders by.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint48[]</code></td><td>An array of uint48 order IDs owned by the specified address.</td></tr>
</tbody></table>
</div>
<h3 id="setfee"><a class="header" href="#setfee">setFee</a></h3>
<p>This function can only be called by an admin.</p>
<p><em>Sets the fee percentage charged on the token price.</em></p>
<pre><code class="language-solidity">function setFee(uint16 _priceFee) external onlyRole(FEE_SETTER_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_priceFee</code></td><td><code>uint16</code></td><td>The new fee percentage to set.</td></tr>
</tbody></table>
</div>
<h3 id="_checkexecutionlimit"><a class="header" href="#_checkexecutionlimit">_checkExecutionLimit</a></h3>
<p>This function is used to check if the user has reached the limit of daily orders.
This measure is in place to prevent users from spamming the marketplace with orders, leveraging the gasless feature.</p>
<p><em>Checks if an address has not reached the execution limit.</em></p>
<pre><code class="language-solidity">function _checkExecutionLimit(address _user) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address to check the execution limit for.</td></tr>
</tbody></table>
</div>
<h3 id="_msgsender"><a class="header" href="#_msgsender">_msgSender</a></h3>
<pre><code class="language-solidity">function _msgSender() internal view override(ContextUpgradeable, ERC2771ContextUpgradeable) returns (address sender);
</code></pre>
<h3 id="_msgdata"><a class="header" href="#_msgdata">_msgData</a></h3>
<pre><code class="language-solidity">function _msgData() internal view override(ContextUpgradeable, ERC2771ContextUpgradeable) returns (bytes calldata);
</code></pre>
<h3 id="_contextsuffixlength"><a class="header" href="#_contextsuffixlength">_contextSuffixLength</a></h3>
<pre><code class="language-solidity">function _contextSuffixLength()
    internal
    view
    override(ContextUpgradeable, ERC2771ContextUpgradeable)
    returns (uint256);
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="make"><a class="header" href="#make">Make</a></h3>
<p><em>Event emitted when a new order is created</em></p>
<pre><code class="language-solidity">event Make(address indexed buyer, uint256 amountIn);
</code></pre>
<h3 id="take"><a class="header" href="#take">Take</a></h3>
<p><em>Event emitted when an order is executed</em></p>
<pre><code class="language-solidity">event Take(address indexed seller, uint256 amountIn, uint256 amountOut, uint256[] amountsCSAT, address[] owners);
</code></pre>
<h3 id="cancelorder"><a class="header" href="#cancelorder">CancelOrder</a></h3>
<pre><code class="language-solidity">event CancelOrder(address indexed owner, uint256 amount);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="pricelessthanzero"><a class="header" href="#pricelessthanzero">PriceLessThanZero</a></h3>
<p><em>Error thrown when the price of an order is less than zero</em></p>
<pre><code class="language-solidity">error PriceLessThanZero();
</code></pre>
<h3 id="notenoughbalance"><a class="header" href="#notenoughbalance">NotEnoughBalance</a></h3>
<p><em>Error thrown when a user does not have enough balance to execute an order</em></p>
<pre><code class="language-solidity">error NotEnoughBalance();
</code></pre>
<h3 id="fallbackordernotenough"><a class="header" href="#fallbackordernotenough">FallbackOrderNotEnough</a></h3>
<p><em>Error thrown when a fallback order is created but there is not enough balance to execute it</em></p>
<pre><code class="language-solidity">error FallbackOrderNotEnough();
</code></pre>
<h3 id="noorderisenoughtobefallback"><a class="header" href="#noorderisenoughtobefallback">NoOrderIsEnoughToBeFallback</a></h3>
<p><em>Error thrown when a fallback order is requested but there are no orders available to use as fallback</em></p>
<pre><code class="language-solidity">error NoOrderIsEnoughToBeFallback();
</code></pre>
<h3 id="notorderowner"><a class="header" href="#notorderowner">NotOrderOwner</a></h3>
<p><em>Error thrown when a user tries to execute an order they do not own</em></p>
<pre><code class="language-solidity">error NotOrderOwner();
</code></pre>
<h3 id="userdoesnothaveorders"><a class="header" href="#userdoesnothaveorders">UserDoesNotHaveOrders</a></h3>
<p><em>Error thrown when a user tries to execute an order but they do not have any orders</em></p>
<pre><code class="language-solidity">error UserDoesNotHaveOrders();
</code></pre>
<h3 id="sellordertoosmall"><a class="header" href="#sellordertoosmall">SellOrderTooSmall</a></h3>
<p><em>Error thrown when a sell order is too small to be executed</em></p>
<pre><code class="language-solidity">error SellOrderTooSmall();
</code></pre>
<h3 id="executionlimitreached"><a class="header" href="#executionlimitreached">ExecutionLimitReached</a></h3>
<pre><code class="language-solidity">error ExecutionLimitReached(address user);
</code></pre>
<h3 id="buyordertoosmall"><a class="header" href="#buyordertoosmall">BuyOrderTooSmall</a></h3>
<p><em>Error thrown when a buy order is too small to be executed</em></p>
<pre><code class="language-solidity">error BuyOrderTooSmall();
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="buyuinthelper"><a class="header" href="#buyuinthelper">BuyUintHelper</a></h3>
<pre><code class="language-solidity">struct BuyUintHelper {
    uint256 amountOut;
    uint256 unmatchedAmount;
    uint256 remainder;
    uint256 index;
    uint48 currentId;
    uint256 tokensToVault;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../src/CSAMarketplace/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../src/CSAMarketplace/CSAMarketplaceStorageContract.sol/contract.CSAMarketplaceStorageContract.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../src/CSAMarketplace/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../src/CSAMarketplace/CSAMarketplaceStorageContract.sol/contract.CSAMarketplaceStorageContract.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
